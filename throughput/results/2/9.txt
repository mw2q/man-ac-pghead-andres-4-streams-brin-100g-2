BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%sandy%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |   2742509428.336
 ALGERIA                   |   1997 | 4646891062.64256
 ALGERIA                   |   1996 | 4706874009.06412
 ALGERIA                   |   1995 | 4676569165.02482
 ALGERIA                   |   1994 | 4668286094.45358
 ALGERIA                   |   1993 | 4677555187.02866
 ALGERIA                   |   1992 | 4682544999.04945
 ARGENTINA                 |   1998 | 2716980438.98736
 ARGENTINA                 |   1997 | 4653381415.99658
 ARGENTINA                 |   1996 | 4669096585.79754
 ARGENTINA                 |   1995 |  4634238492.7009
 ARGENTINA                 |   1994 | 4663797428.02308
 ARGENTINA                 |   1993 |  4649811815.9599
 ARGENTINA                 |   1992 | 4651262052.18577
 BRAZIL                    |   1998 |  2744518749.0651
 BRAZIL                    |   1997 | 4664715937.67974
 BRAZIL                    |   1996 | 4674985074.69356
 BRAZIL                    |   1995 | 4684557161.06394
 BRAZIL                    |   1994 | 4656840398.00797
 BRAZIL                    |   1993 | 4669388920.23054
 BRAZIL                    |   1992 | 4708102229.97569
 CANADA                    |   1998 | 2729099349.35335
 CANADA                    |   1997 | 4663120021.70293
 CANADA                    |   1996 | 4678949407.59096
 CANADA                    |   1995 |  4648181691.2787
 CANADA                    |   1994 | 4685047867.96028
 CANADA                    |   1993 | 4644968515.43439
 CANADA                    |   1992 | 4654381511.27414
 CHINA                     |   1998 | 2732904609.42808
 CHINA                     |   1997 | 4659289667.03973
 CHINA                     |   1996 | 4666757941.67024
 CHINA                     |   1995 | 4669001705.22248
 CHINA                     |   1994 | 4652390890.08522
 CHINA                     |   1993 | 4650612053.46234
 CHINA                     |   1992 | 4678994200.86666
 EGYPT                     |   1998 | 2760606325.00356
 EGYPT                     |   1997 |  4644803802.3359
 EGYPT                     |   1996 |  4664732817.4266
 EGYPT                     |   1995 | 4651536232.94109
 EGYPT                     |   1994 | 4652629729.05054
 EGYPT                     |   1993 | 4656417852.31371
 EGYPT                     |   1992 |  4672056821.1902
 ETHIOPIA                  |   1998 | 2749936529.26756
 ETHIOPIA                  |   1997 | 4701744828.24524
 ETHIOPIA                  |   1996 | 4708015200.97158
 ETHIOPIA                  |   1995 | 4698349118.10986
 ETHIOPIA                  |   1994 | 4702945688.17123
 ETHIOPIA                  |   1993 | 4697802421.44415
 ETHIOPIA                  |   1992 | 4709656558.68318
 FRANCE                    |   1998 | 2732932627.51084
 FRANCE                    |   1997 | 4690967018.38207
 FRANCE                    |   1996 |  4700225330.2106
 FRANCE                    |   1995 | 4656552333.51042
 FRANCE                    |   1994 | 4687155254.25107
 FRANCE                    |   1993 | 4677444218.20529
 FRANCE                    |   1992 |  4694505456.7539
 GERMANY                   |   1998 | 2741905048.20186
 GERMANY                   |   1997 | 4689146843.14095
 GERMANY                   |   1996 | 4695814392.46851
 GERMANY                   |   1995 | 4677028354.54316
 GERMANY                   |   1994 |  4693541112.7229
 GERMANY                   |   1993 | 4698830227.61842
 GERMANY                   |   1992 | 4699161359.49911
 INDIA                     |   1998 | 2754443607.96651
 INDIA                     |   1997 | 4695836295.51588
 INDIA                     |   1996 | 4677758114.43196
 INDIA                     |   1995 | 4667450817.64046
 INDIA                     |   1994 | 4677377784.09843
 INDIA                     |   1993 | 4680604980.52372
 INDIA                     |   1992 | 4679618548.32581
 INDONESIA                 |   1998 | 2738236700.00097
 INDONESIA                 |   1997 | 4631887362.22436
 INDONESIA                 |   1996 | 4636134592.61588
 INDONESIA                 |   1995 | 4613882558.33964
 INDONESIA                 |   1994 | 4626934245.47232
 INDONESIA                 |   1993 | 4620366321.08635
 INDONESIA                 |   1992 | 4620537315.18244
 IRAN                      |   1998 | 2720644835.07802
 IRAN                      |   1997 | 4634105920.90107
 IRAN                      |   1996 | 4648355923.31281
 IRAN                      |   1995 | 4637967144.17309
 IRAN                      |   1994 | 4606247658.10368
 IRAN                      |   1993 |  4648361724.6279
 IRAN                      |   1992 | 4631994678.16427
 IRAQ                      |   1998 | 2721489830.17068
 IRAQ                      |   1997 | 4663430142.57024
 IRAQ                      |   1996 |  4636545535.7886
 IRAQ                      |   1995 | 4631522666.08556
 IRAQ                      |   1994 | 4637415129.53246
 IRAQ                      |   1993 | 4636436314.36589
 IRAQ                      |   1992 |  4660539674.9945
 JAPAN                     |   1998 | 2708639669.11372
 JAPAN                     |   1997 | 4608216393.27867
 JAPAN                     |   1996 | 4634149109.06225
 JAPAN                     |   1995 |  4618821315.6572
 JAPAN                     |   1994 | 4634663630.16674
 JAPAN                     |   1993 |  4602092799.5442
 JAPAN                     |   1992 |  4644688676.2504
 JORDAN                    |   1998 | 2723663123.17686
 JORDAN                    |   1997 | 4646812772.63749
 JORDAN                    |   1996 | 4663969191.98176
 JORDAN                    |   1995 | 4615372111.74261
 JORDAN                    |   1994 | 4664503674.60463
 JORDAN                    |   1993 | 4651690990.53216
 JORDAN                    |   1992 | 4638737484.07682
 KENYA                     |   1998 | 2722238740.03056
 KENYA                     |   1997 | 4624905556.20123
 KENYA                     |   1996 | 4658909313.50896
 KENYA                     |   1995 |  4646408600.4207
 KENYA                     |   1994 | 4616707020.15518
 KENYA                     |   1993 | 4629434299.03375
 KENYA                     |   1992 | 4642993237.37339
 MOROCCO                   |   1998 | 2732753464.44933
 MOROCCO                   |   1997 | 4659140458.76225
 MOROCCO                   |   1996 | 4652082920.88758
 MOROCCO                   |   1995 | 4657944119.18172
 MOROCCO                   |   1994 | 4679555022.80101
 MOROCCO                   |   1993 | 4671626049.51655
 MOROCCO                   |   1992 | 4683520836.58078
 MOZAMBIQUE                |   1998 | 2707237089.68151
 MOZAMBIQUE                |   1997 | 4666878955.99385
 MOZAMBIQUE                |   1996 | 4666317724.00765
 MOZAMBIQUE                |   1995 | 4661977634.46453
 MOZAMBIQUE                |   1994 | 4666600737.44414
 MOZAMBIQUE                |   1993 | 4656714280.35429
 MOZAMBIQUE                |   1992 | 4664511143.76876
 PERU                      |   1998 | 2695659132.71929
 PERU                      |   1997 | 4628814870.70002
 PERU                      |   1996 | 4640136066.44317
 PERU                      |   1995 | 4642774775.36067
 PERU                      |   1994 | 4616312166.98449
 PERU                      |   1993 | 4614810386.09634
 PERU                      |   1992 | 4647451852.70509
 ROMANIA                   |   1998 | 2751945293.59683
 ROMANIA                   |   1997 | 4660472183.22471
 ROMANIA                   |   1996 | 4640904172.23169
 ROMANIA                   |   1995 | 4673049795.80148
 ROMANIA                   |   1994 |  4660264246.0989
 ROMANIA                   |   1993 | 4647945999.24666
 ROMANIA                   |   1992 | 4677487244.30341
 RUSSIA                    |   1998 | 2710992481.48147
 RUSSIA                    |   1997 | 4656440746.77163
 RUSSIA                    |   1996 | 4689135612.92782
 RUSSIA                    |   1995 | 4672691373.66576
 RUSSIA                    |   1994 | 4646655558.06118
 RUSSIA                    |   1993 | 4660157564.71355
 RUSSIA                    |   1992 | 4655623767.56645
 SAUDI ARABIA              |   1998 | 2717176372.40698
 SAUDI ARABIA              |   1997 | 4638687260.36225
 SAUDI ARABIA              |   1996 | 4681074205.90396
 SAUDI ARABIA              |   1995 | 4670836830.81127
 SAUDI ARABIA              |   1994 | 4640267639.08698
 SAUDI ARABIA              |   1993 | 4671030794.29606
 SAUDI ARABIA              |   1992 |  4663649880.2483
 UNITED KINGDOM            |   1998 |  2747640460.7012
 UNITED KINGDOM            |   1997 | 4691225536.27749
 UNITED KINGDOM            |   1996 | 4700275565.93983
 UNITED KINGDOM            |   1995 |  4654104700.2037
 UNITED KINGDOM            |   1994 | 4676067524.93294
 UNITED KINGDOM            |   1993 | 4691132077.33676
 UNITED KINGDOM            |   1992 | 4694055730.69049
 UNITED STATES             |   1998 | 2744179353.60152
 UNITED STATES             |   1997 | 4687614445.03424
 UNITED STATES             |   1996 | 4715329167.41796
 UNITED STATES             |   1995 | 4674891130.06502
 UNITED STATES             |   1994 | 4677113578.51193
 UNITED STATES             |   1993 | 4706907794.16581
 UNITED STATES             |   1992 | 4702987736.88428
 VIETNAM                   |   1998 | 2712873016.03736
 VIETNAM                   |   1997 |  4660169866.4802
 VIETNAM                   |   1996 | 4672512843.98705
 VIETNAM                   |   1995 | 4669954733.78349
 VIETNAM                   |   1994 | 4672845165.30087
 VIETNAM                   |   1993 |  4646282127.4578
 VIETNAM                   |   1992 | 4668797632.15692
(175 rows)

COMMIT;
COMMIT
