BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peru%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2711296240.19944
 ALGERIA                   |   1997 | 4618610823.78388
 ALGERIA                   |   1996 | 4659625676.68623
 ALGERIA                   |   1995 | 4661137104.81849
 ALGERIA                   |   1994 | 4658536229.74494
 ALGERIA                   |   1993 | 4655664794.91026
 ALGERIA                   |   1992 | 4648219701.59708
 ARGENTINA                 |   1998 | 2719730199.44225
 ARGENTINA                 |   1997 | 4626116443.02969
 ARGENTINA                 |   1996 | 4671938073.87472
 ARGENTINA                 |   1995 | 4643544541.34807
 ARGENTINA                 |   1994 | 4632879397.96501
 ARGENTINA                 |   1993 | 4615132512.65465
 ARGENTINA                 |   1992 | 4631582024.78408
 BRAZIL                    |   1998 | 2737735812.86447
 BRAZIL                    |   1997 |   4692710951.949
 BRAZIL                    |   1996 | 4701397257.63433
 BRAZIL                    |   1995 | 4696487092.02246
 BRAZIL                    |   1994 | 4660635074.13882
 BRAZIL                    |   1993 |  4657737664.8609
 BRAZIL                    |   1992 | 4681767873.37717
 CANADA                    |   1998 | 2764020749.03083
 CANADA                    |   1997 | 4703319029.18541
 CANADA                    |   1996 |  4706937685.6763
 CANADA                    |   1995 |  4691981159.0292
 CANADA                    |   1994 | 4708369511.38816
 CANADA                    |   1993 | 4721465359.94585
 CANADA                    |   1992 | 4704796651.67502
 CHINA                     |   1998 | 2731443013.94432
 CHINA                     |   1997 | 4651312982.02006
 CHINA                     |   1996 | 4671677303.41235
 CHINA                     |   1995 | 4646879002.42791
 CHINA                     |   1994 | 4655259588.79695
 CHINA                     |   1993 | 4641665262.53226
 CHINA                     |   1992 | 4669391612.76738
 EGYPT                     |   1998 |  2729407470.0936
 EGYPT                     |   1997 | 4674021833.86136
 EGYPT                     |   1996 | 4672371286.13133
 EGYPT                     |   1995 | 4656601089.56383
 EGYPT                     |   1994 | 4665518256.33549
 EGYPT                     |   1993 | 4649047494.38289
 EGYPT                     |   1992 | 4679811632.01852
 ETHIOPIA                  |   1998 | 2741128920.48004
 ETHIOPIA                  |   1997 | 4686109259.70316
 ETHIOPIA                  |   1996 | 4684616874.71584
 ETHIOPIA                  |   1995 |  4660601433.0909
 ETHIOPIA                  |   1994 | 4719488966.93914
 ETHIOPIA                  |   1993 | 4672085486.42975
 ETHIOPIA                  |   1992 | 4700673051.08503
 FRANCE                    |   1998 |   2735633140.332
 FRANCE                    |   1997 |   4684209481.995
 FRANCE                    |   1996 |  4678897097.7808
 FRANCE                    |   1995 | 4698518894.26199
 FRANCE                    |   1994 | 4686707827.23864
 FRANCE                    |   1993 | 4669846911.21924
 FRANCE                    |   1992 |  4696088223.4814
 GERMANY                   |   1998 | 2767988257.47202
 GERMANY                   |   1997 | 4704823197.42134
 GERMANY                   |   1996 | 4708258998.22311
 GERMANY                   |   1995 | 4705106365.09255
 GERMANY                   |   1994 |  4687585891.9135
 GERMANY                   |   1993 | 4693418475.02868
 GERMANY                   |   1992 | 4690113258.85097
 INDIA                     |   1998 | 2748839274.41959
 INDIA                     |   1997 | 4684753639.10557
 INDIA                     |   1996 | 4669984462.54883
 INDIA                     |   1995 | 4679966069.75873
 INDIA                     |   1994 | 4692191416.55944
 INDIA                     |   1993 | 4683650749.07237
 INDIA                     |   1992 | 4706069748.66677
 INDONESIA                 |   1998 | 2736692301.36865
 INDONESIA                 |   1997 | 4645035270.13458
 INDONESIA                 |   1996 | 4652419148.16129
 INDONESIA                 |   1995 | 4636218135.36609
 INDONESIA                 |   1994 | 4641745474.98283
 INDONESIA                 |   1993 | 4619099224.22215
 INDONESIA                 |   1992 | 4652725819.34628
 IRAN                      |   1998 | 2744853863.64677
 IRAN                      |   1997 | 4643429827.21385
 IRAN                      |   1996 | 4660957248.87344
 IRAN                      |   1995 | 4641248615.52568
 IRAN                      |   1994 |  4627540593.1827
 IRAN                      |   1993 | 4643511873.81966
 IRAN                      |   1992 |  4673219593.5178
 IRAQ                      |   1998 | 2718348458.53111
 IRAQ                      |   1997 | 4641173739.33849
 IRAQ                      |   1996 | 4650276672.94797
 IRAQ                      |   1995 | 4610252404.43607
 IRAQ                      |   1994 |  4634904183.0673
 IRAQ                      |   1993 | 4617752008.47857
 IRAQ                      |   1992 | 4639524918.89642
 JAPAN                     |   1998 |  2724949067.6229
 JAPAN                     |   1997 | 4623053191.16309
 JAPAN                     |   1996 | 4656208198.93395
 JAPAN                     |   1995 | 4634831271.50601
 JAPAN                     |   1994 | 4624202571.13966
 JAPAN                     |   1993 | 4610222307.11185
 JAPAN                     |   1992 | 4659433090.95567
 JORDAN                    |   1998 | 2743836703.17583
 JORDAN                    |   1997 | 4620487717.04698
 JORDAN                    |   1996 | 4657945697.43663
 JORDAN                    |   1995 | 4649967384.81642
 JORDAN                    |   1994 | 4646747971.77754
 JORDAN                    |   1993 | 4670820611.26278
 JORDAN                    |   1992 | 4660586479.09216
 KENYA                     |   1998 | 2696355956.27588
 KENYA                     |   1997 | 4617424602.47613
 KENYA                     |   1996 | 4637084759.18407
 KENYA                     |   1995 | 4598124866.29053
 KENYA                     |   1994 | 4610855626.51865
 KENYA                     |   1993 | 4619291044.94858
 KENYA                     |   1992 | 4616462980.69998
 MOROCCO                   |   1998 | 2748311283.61621
 MOROCCO                   |   1997 | 4675003213.18272
 MOROCCO                   |   1996 |  4706937050.1501
 MOROCCO                   |   1995 | 4637403044.00294
 MOROCCO                   |   1994 | 4651441183.15359
 MOROCCO                   |   1993 | 4670783567.86093
 MOROCCO                   |   1992 | 4676722084.63162
 MOZAMBIQUE                |   1998 | 2723760689.29934
 MOZAMBIQUE                |   1997 | 4616205136.30971
 MOZAMBIQUE                |   1996 | 4657300306.13848
 MOZAMBIQUE                |   1995 | 4643357554.69025
 MOZAMBIQUE                |   1994 | 4655359477.30673
 MOZAMBIQUE                |   1993 | 4649486646.59826
 MOZAMBIQUE                |   1992 | 4661296333.63212
 PERU                      |   1998 | 2714678400.11585
 PERU                      |   1997 | 4610068966.60313
 PERU                      |   1996 | 4635865492.17221
 PERU                      |   1995 | 4645158747.70166
 PERU                      |   1994 |  4640310002.9747
 PERU                      |   1993 | 4621359497.97486
 PERU                      |   1992 |  4643681722.8864
 ROMANIA                   |   1998 |   2742518937.687
 ROMANIA                   |   1997 | 4700133995.84073
 ROMANIA                   |   1996 | 4711973633.71243
 ROMANIA                   |   1995 | 4677190354.38108
 ROMANIA                   |   1994 | 4685239281.26465
 ROMANIA                   |   1993 | 4683191819.41564
 ROMANIA                   |   1992 | 4675946477.53054
 RUSSIA                    |   1998 | 2720017961.00245
 RUSSIA                    |   1997 | 4662754261.08025
 RUSSIA                    |   1996 | 4679388300.62489
 RUSSIA                    |   1995 | 4662899356.49123
 RUSSIA                    |   1994 | 4657316084.91688
 RUSSIA                    |   1993 | 4653311143.75523
 RUSSIA                    |   1992 | 4672621648.74125
 SAUDI ARABIA              |   1998 | 2724217493.11836
 SAUDI ARABIA              |   1997 | 4634329135.73824
 SAUDI ARABIA              |   1996 | 4668349375.81204
 SAUDI ARABIA              |   1995 | 4616148435.74354
 SAUDI ARABIA              |   1994 | 4650878071.27217
 SAUDI ARABIA              |   1993 | 4636933269.41852
 SAUDI ARABIA              |   1992 |  4675791605.9081
 UNITED KINGDOM            |   1998 | 2752865814.60817
 UNITED KINGDOM            |   1997 | 4697373189.70217
 UNITED KINGDOM            |   1996 | 4695954348.10995
 UNITED KINGDOM            |   1995 | 4686464512.53323
 UNITED KINGDOM            |   1994 |  4686938368.4605
 UNITED KINGDOM            |   1993 | 4676845886.85086
 UNITED KINGDOM            |   1992 | 4683794036.10045
 UNITED STATES             |   1998 | 2738500417.12487
 UNITED STATES             |   1997 | 4662231161.85687
 UNITED STATES             |   1996 | 4678723747.06044
 UNITED STATES             |   1995 | 4665452944.06672
 UNITED STATES             |   1994 | 4651090084.61962
 UNITED STATES             |   1993 | 4683829778.79276
 UNITED STATES             |   1992 | 4673634976.14914
 VIETNAM                   |   1998 | 2743778189.51504
 VIETNAM                   |   1997 |  4688548289.0335
 VIETNAM                   |   1996 | 4705111789.39874
 VIETNAM                   |   1995 |  4701744641.9627
 VIETNAM                   |   1994 | 4688852689.65844
 VIETNAM                   |   1993 | 4690065303.54516
 VIETNAM                   |   1992 |  4712380454.6004
(175 rows)

COMMIT;
COMMIT
