BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%red%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2742764319.10559
 ALGERIA                   |   1997 |  4678997296.7377
 ALGERIA                   |   1996 | 4656976673.00654
 ALGERIA                   |   1995 |  4659493039.0286
 ALGERIA                   |   1994 |  4655087242.6432
 ALGERIA                   |   1993 | 4634248723.35796
 ALGERIA                   |   1992 | 4665385461.58803
 ARGENTINA                 |   1998 | 2723712811.63777
 ARGENTINA                 |   1997 | 4660678064.77994
 ARGENTINA                 |   1996 | 4655373599.68419
 ARGENTINA                 |   1995 | 4639544051.80525
 ARGENTINA                 |   1994 | 4627365882.70381
 ARGENTINA                 |   1993 |  4654175428.7461
 ARGENTINA                 |   1992 | 4685046077.19967
 BRAZIL                    |   1998 | 2765247186.75615
 BRAZIL                    |   1997 | 4705229659.09984
 BRAZIL                    |   1996 | 4702574984.67061
 BRAZIL                    |   1995 | 4685787828.94858
 BRAZIL                    |   1994 | 4707197306.42015
 BRAZIL                    |   1993 | 4685041532.78194
 BRAZIL                    |   1992 | 4701431921.74633
 CANADA                    |   1998 | 2753235366.03822
 CANADA                    |   1997 | 4696693245.58138
 CANADA                    |   1996 | 4695239743.44578
 CANADA                    |   1995 | 4696551665.04461
 CANADA                    |   1994 | 4686689513.13908
 CANADA                    |   1993 | 4687499485.99938
 CANADA                    |   1992 | 4684249148.22705
 CHINA                     |   1998 | 2743992019.06624
 CHINA                     |   1997 | 4694239626.38229
 CHINA                     |   1996 | 4716127134.23083
 CHINA                     |   1995 | 4689164652.70655
 CHINA                     |   1994 | 4685148290.12742
 CHINA                     |   1993 | 4683349107.87536
 CHINA                     |   1992 | 4702200745.50517
 EGYPT                     |   1998 | 2736260846.29419
 EGYPT                     |   1997 | 4653460073.98649
 EGYPT                     |   1996 | 4666824603.54142
 EGYPT                     |   1995 | 4621772374.02156
 EGYPT                     |   1994 | 4679412383.87242
 EGYPT                     |   1993 | 4676577084.21388
 EGYPT                     |   1992 | 4682306718.60649
 ETHIOPIA                  |   1998 | 2772729941.73913
 ETHIOPIA                  |   1997 | 4736757088.47784
 ETHIOPIA                  |   1996 |  4732393009.2692
 ETHIOPIA                  |   1995 | 4697072126.34983
 ETHIOPIA                  |   1994 | 4716278247.35638
 ETHIOPIA                  |   1993 | 4717499953.84936
 ETHIOPIA                  |   1992 | 4733387380.77953
 FRANCE                    |   1998 | 2740794273.26732
 FRANCE                    |   1997 | 4688702442.23231
 FRANCE                    |   1996 | 4677498951.71984
 FRANCE                    |   1995 | 4674617869.15956
 FRANCE                    |   1994 | 4670658681.50017
 FRANCE                    |   1993 |   4671511326.038
 FRANCE                    |   1992 | 4675012838.34073
 GERMANY                   |   1998 | 2756471774.71976
 GERMANY                   |   1997 | 4688110001.99171
 GERMANY                   |   1996 | 4695826763.58324
 GERMANY                   |   1995 | 4683899364.07334
 GERMANY                   |   1994 |  4682572003.0627
 GERMANY                   |   1993 | 4670560681.25846
 GERMANY                   |   1992 | 4711546771.73197
 INDIA                     |   1998 | 2721846003.97542
 INDIA                     |   1997 | 4672692942.99185
 INDIA                     |   1996 | 4675063088.79603
 INDIA                     |   1995 | 4659272906.99139
 INDIA                     |   1994 |  4647396195.6053
 INDIA                     |   1993 | 4643142995.82877
 INDIA                     |   1992 | 4635695864.24996
 INDONESIA                 |   1998 | 2712161137.41701
 INDONESIA                 |   1997 | 4617332397.81988
 INDONESIA                 |   1996 | 4647934890.98126
 INDONESIA                 |   1995 |  4645473942.4627
 INDONESIA                 |   1994 |  4617366189.7271
 INDONESIA                 |   1993 | 4613960665.24841
 INDONESIA                 |   1992 |  4653476346.8346
 IRAN                      |   1998 | 2749278453.25969
 IRAN                      |   1997 | 4680035196.24478
 IRAN                      |   1996 | 4696500737.86176
 IRAN                      |   1995 | 4643710022.24172
 IRAN                      |   1994 | 4671449286.69185
 IRAN                      |   1993 | 4649314063.42656
 IRAN                      |   1992 | 4692717389.78647
 IRAQ                      |   1998 | 2713879355.32728
 IRAQ                      |   1997 | 4653864024.95054
 IRAQ                      |   1996 | 4617251315.77029
 IRAQ                      |   1995 | 4651596747.61747
 IRAQ                      |   1994 | 4650569750.51417
 IRAQ                      |   1993 | 4672900933.82447
 IRAQ                      |   1992 | 4665188580.21942
 JAPAN                     |   1998 | 2730036098.44807
 JAPAN                     |   1997 |   4643785951.876
 JAPAN                     |   1996 | 4682194237.20604
 JAPAN                     |   1995 | 4655304140.04805
 JAPAN                     |   1994 | 4647330042.52511
 JAPAN                     |   1993 | 4649849397.80455
 JAPAN                     |   1992 | 4644318321.95149
 JORDAN                    |   1998 | 2752757127.42399
 JORDAN                    |   1997 | 4677875988.10939
 JORDAN                    |   1996 | 4684271479.31391
 JORDAN                    |   1995 | 4653800281.97112
 JORDAN                    |   1994 | 4664025426.62909
 JORDAN                    |   1993 | 4686967533.42595
 JORDAN                    |   1992 | 4670860467.98793
 KENYA                     |   1998 | 2725672708.34024
 KENYA                     |   1997 | 4628560942.75729
 KENYA                     |   1996 | 4663930985.83358
 KENYA                     |   1995 | 4608870453.39445
 KENYA                     |   1994 | 4634950267.19288
 KENYA                     |   1993 | 4656851250.10283
 KENYA                     |   1992 | 4651474633.72071
 MOROCCO                   |   1998 | 2726458999.48351
 MOROCCO                   |   1997 | 4700383175.42808
 MOROCCO                   |   1996 | 4690909711.48737
 MOROCCO                   |   1995 | 4668935044.62738
 MOROCCO                   |   1994 | 4664007704.26223
 MOROCCO                   |   1993 | 4676441549.72791
 MOROCCO                   |   1992 | 4679833771.88528
 MOZAMBIQUE                |   1998 | 2758299742.32594
 MOZAMBIQUE                |   1997 | 4694658979.29551
 MOZAMBIQUE                |   1996 |  4703159189.6065
 MOZAMBIQUE                |   1995 | 4666648779.44127
 MOZAMBIQUE                |   1994 | 4694666173.76025
 MOZAMBIQUE                |   1993 | 4658339850.98491
 MOZAMBIQUE                |   1992 | 4669989689.84392
 PERU                      |   1998 | 2714864577.85375
 PERU                      |   1997 | 4640962678.85549
 PERU                      |   1996 | 4656747331.78549
 PERU                      |   1995 | 4649477255.50453
 PERU                      |   1994 | 4635192897.90048
 PERU                      |   1993 | 4606518139.70437
 PERU                      |   1992 | 4639412260.64928
 ROMANIA                   |   1998 | 2727413021.99333
 ROMANIA                   |   1997 | 4695067896.32933
 ROMANIA                   |   1996 | 4704700961.52366
 ROMANIA                   |   1995 | 4678849263.09786
 ROMANIA                   |   1994 | 4684123421.41059
 ROMANIA                   |   1993 | 4683935235.15756
 ROMANIA                   |   1992 | 4668403424.27655
 RUSSIA                    |   1998 | 2729082099.55512
 RUSSIA                    |   1997 | 4680385147.36618
 RUSSIA                    |   1996 | 4703297614.15911
 RUSSIA                    |   1995 | 4665376646.65491
 RUSSIA                    |   1994 | 4655529177.99565
 RUSSIA                    |   1993 | 4668577250.69339
 RUSSIA                    |   1992 | 4663337180.72805
 SAUDI ARABIA              |   1998 | 2736661624.65352
 SAUDI ARABIA              |   1997 | 4661920104.86626
 SAUDI ARABIA              |   1996 | 4673240496.03714
 SAUDI ARABIA              |   1995 | 4673584216.07761
 SAUDI ARABIA              |   1994 | 4684848972.80856
 SAUDI ARABIA              |   1993 | 4647713959.24019
 SAUDI ARABIA              |   1992 | 4683351984.12288
 UNITED KINGDOM            |   1998 | 2766491252.92364
 UNITED KINGDOM            |   1997 | 4716843407.52748
 UNITED KINGDOM            |   1996 | 4724975861.03641
 UNITED KINGDOM            |   1995 | 4707125062.66468
 UNITED KINGDOM            |   1994 | 4727746059.86096
 UNITED KINGDOM            |   1993 | 4737870362.82823
 UNITED KINGDOM            |   1992 | 4729678265.43071
 UNITED STATES             |   1998 | 2725133929.67957
 UNITED STATES             |   1997 | 4666358859.85364
 UNITED STATES             |   1996 | 4693434911.38911
 UNITED STATES             |   1995 | 4666892001.54222
 UNITED STATES             |   1994 | 4663672979.55407
 UNITED STATES             |   1993 | 4667639630.84581
 UNITED STATES             |   1992 |  4681704545.0393
 VIETNAM                   |   1998 | 2742399500.10203
 VIETNAM                   |   1997 | 4688169193.47645
 VIETNAM                   |   1996 | 4683416384.41396
 VIETNAM                   |   1995 | 4683573498.11725
 VIETNAM                   |   1994 | 4691915078.00093
 VIETNAM                   |   1993 | 4672620546.18812
 VIETNAM                   |   1992 |  4710887026.3051
(175 rows)

COMMIT;
COMMIT
